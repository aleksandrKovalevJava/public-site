<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Text JS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
    <script type="text/javascript" src="js/data.json"></script>
    <script type="text/javascript">
	var encryptedAES = CryptoJS.AES.encrypt("Message", "SecretPassphrase");
	var decryptedBytes = CryptoJS.AES.decrypt(encryptedAES, "SecretPassphrase");
	// get full URL and parse pat params: http://localhost:8080/?certId=1&secret=SecretPassphrase
	var url = new URL(window.location.href);
	var certId = url.searchParams.get("certId");
	var secret = url.searchParams.get("secret");


	// update inner HTML
	window.onload = function() {
		getJson();

		function getJson() {
			document.getElementById("demo3").innerHTML = decryptedBytes.toString(CryptoJS.enc.Utf8);
			document.getElementById("certId").innerHTML = certId;
			document.getElementById("secret").innerHTML = secret;

			fetch("./js/data.json").then(response => response.json()).then(json => {
				json.forEach(function(dataJson) {
					if(dataJson[Object.keys(dataJson)[0]] == certId) {
					    var pdfData = dataJson[Object.keys(dataJson)[1]];
						if(pdfData.length > 100){
	                        document.getElementById('pdfIframe').src = "data:application/pdf;base64," + dataJson[Object.keys(dataJson)[1]];
						    document.getElementById('pdfIframe').style.display = 'flex';
						}
						document.getElementById("dataByFileId").innerHTML = dataJson[Object.keys(dataJson)[1]];
					}
				})
			})
		};
	}
	</script>
</head>

<body>
<h1>Hello!</h1>
<br>
<label>Actual Message</label> <b>
    <div id="demo3"></div>
</b>
<br>
<label>certId</label> <b>
    <div id="certId"></div>
</b>
<br>
<label>data by fileId</label> <b>
    <div id="dataByFileId"></div>
</b>
<br>
<label>secret</label> <b>
    <div id="secret"></div>
</b>
<br>
<br>
<iframe id="pdfIframe"
        style="display: none; width: 100%; height: 800px">
</iframe>

</body>

</html>
